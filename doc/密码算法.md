# 密码算法

- 分组密码: SM4(CBC, CTR, GCM), AES(GCM)
- 序列密码: ZUC/ZUC-256, ChaCha20, RC4
- 哈希函数: SM3, SHA-224/256/384/512, SHA-1, MD5
- 公钥密码算法: SM2, SM9, ECDH, ECDSA
- 椭圆曲线参数: SM2, NIST-P256
- 伪随机数生成器: HASH_DRBG (NIST.SP.800-90A)
- MAC算法: HMAC, GHASH
- 密钥导出函数: PBKDF2, HKDF

## 分组密码

分组密码是对称密码体制中的一大类算法, 其核心思想是: 把明文按固定长度的"分组"进行处理, 在密钥控制下将每个分组映射为等长的密文分组.

- 分组长度: 常见为64位或128位
- 密钥长度: 常见128/192/256位

特点:
- 输入: 固定长度明文块
- 输出: 固定长度密文块
- 在相同密钥下是可逆的——映射

数学上可以表示为：
```
C = E_K(P)
P = D_K(C)
```

实现原理:
- 切块: 把数据切成固定大小的块
- 多次变换:
  - 非线性: 用一张固定对照表, 把每个字节换成另一个字节, 看起来毫无规律
  - 扩散: 把数据的位置打乱, 让原来相邻的东西分开
  - 惨密钥: 用密钥参与计算(一般是XOR); 没密钥则结果完全不一样
- 重复第2步操作

解密过程是加密过程相反的操作.

## 序列密码

序列密码是一类对称加密算法, 其核心思想是: 生成一个伪随机密钥序列(密钥流), 逐位(或逐字节)与明文进行运算得到密文, 通常使用异或(XOR).

基本原理:
- 明文: P
- 密钥流: K
- 密文: C = P 异或 K
- 解密: P = C 异或 K

只要发送方和接收方使用相同的密钥和初始状态(IV/nonce), 就能生成相同的密钥流

主要特点:
- 优点:
  - 数度快、延迟低、适合实时通信
  - 算法结构简单, 软/硬件实现高效
  - 适用于流式数据(语音、视频、网络数据)
- 缺点:
  - 密钥流不能重复使用(否则会被攻击)
  - 对同步要求高、丢失或插入数据会导致解密错误
  - 设计不当的序列密码容易被破解

分类:
- 同步序列密码
  - 密钥流只依赖密钥和初始向量
  - 常见如: RC4、ChaCha20
  - 优点: 结构简单
  - 缺点: 一旦丢失同步就难以恢复
- 自同步序列密码
  - 密钥流依赖前若干位密文
  - 优点: 可自动恢复同步
  - 缺点: 错误会扩散

典型算法:
- RC4(已不安全, 不推荐)
- ChaCha20(现代主流, 安全性高)
- Salsa20
- SNOW 3G(移动通信)

## 哈希函数

哈希函数是一种把任意长度输入映射为固定长度输出的函数, 输出称为哈希值.

主要特性(密码学哈希):
- 单向性(不可逆): 有哈希值难以反推出原文
- 抗碰撞性: 难以找到两份不同输入使哈希值相同
- 雪崩效应: 输入微小变化, 输出大幅变化
- 确定性: 相同输入必得相同输出

常见算法:
- MD5(已不安全)
- SHA-1(已不安全)
- SHA-256/SHA-3(安全、主流)
- BLAKE2/BLAKE3(速度快)

## 公钥密码算法

公钥密码算法(Public-Key Cryptography)是一类使用密钥对(公钥/私钥)进行加密、解密或签名的密码算法.

基本概念:
- 公钥(PK): 可以公开
- 私钥(SK): 必须保密

公钥和私钥在数学上相关, 但是由公钥无法推导私钥

解决问题:
- 密钥分发难题(无须实现共享秘密)
- 身份认证
- 数字签名
- 安全密钥交换

主要算法:
- RSA
  - 基于大整数分解
  - 可用于加密和签名
  - 密钥较大, 性能一般
- 椭圆曲线密码(ECC)
  - 基于椭圆曲线离散对数
  - 密钥短、速度快
  - 如: ECDH、ECDSA、Ed25519
- EIGammal/DSA
  - 基于离散对数
  - 主要用于签名或密钥交换

典型用途:
- TLS/HTTPS
- 数字签名、证书
- 安全启动、软件签名
- 安全通信初始化

## 椭圆曲线参数

椭圆曲线参数是一条椭圆曲线以及运算规则的一组常量, 它们共同决定了椭圆曲线密码(ECC)的安全性和可互操作性.

核心参数:
- 有限域参数: p, 素数, 定义素数域
- 曲线参数: a, b: 曲线系数, 必须保证曲线无奇异点
- 基点(生成元): G(Gx, Gy): 曲线上选定的基点
- 阶(order): 
  - n: 基点G的阶
  - 即: nG = O
- 余因子: h曲线点总数/n

常见标准曲线参数集:
- secp256r1(P-256)
- secp384r1
- Curve25519/Ed25519

这些参数通常由标准组织给出, 直接使用即可.

参数的作用:
- 安全性由: p、n的位数决定
- G、n决定离散对数难度
- h影响实现安全(小子群攻击)

## 伪随机数生成器

伪随机数生成器(PRNG, Pseudo-Random Number Generator)是一种确定性算法从初始种子(seed)生成看似随机的数列的机制.

基本概念:
- 输入: 种子(seed)
- 输出: 随机数序列
- 特点: 相同种子 -> 相同序列

核心性质:
- 统计随机性: 分布接近真正随机
- 不可预测性(CSPRNG): 无法根据已知输出推测未来或过去的值
- 周期足够长
- 种子敏感性(雪崩效应)

分类:
- 普通 PRNG:
  - 用于仿真、游戏
  - 例: LCG、Mersenne Twister(不安全)
- 密码学安全PRNG(CSPRNG)
  - 用于密钥、IV、nonce
  - 例:
    - CTR-DRBG(AES)
    - HMAC-DRBG
    - ChaCha20-based PRNG
    - /dev/urandom

典型应用:
- 密钥/IV/nonce生成
- 序列密码的密钥流
- 随机挑战值
- 协议安全参数

## MAC 算法

MAC 算法(Message Authentication Code, 消息认证码), 是一种用于验证消息完整性和真实性的对称密钥算法.

基本概念:
- 输入: 消息 M + 共享密钥 K
- 输出: 固定长度的 MAC 值
- 验证: 接收一方用统一密钥重新计算并比对

MAC 解决的问题:
- 完整性: 消息未被篡改
- 身份真实性: 消息来自持有密钥的一方

常见 MAC 算法:
- HMAC: 基于哈希函数(如: HMAC-SHA256), 应用最广, 安全可靠
- CMAC: 基于分组密码(如: AES-CMAC), 常用于嵌入式和通信协议
- Poly1305: 高速 MAC, 常与 ChaCha20 搭配, 如: ChaCha20-Poly1305(AEAD)

典型应用:
- 网络协议: TLS、IPsec
- API 请求签名
- 消息防篡改
- 软件更新校验

## 密钥导出函数(KDF)

密钥导出函数(KDF, Key Derivation Function) 是一种从已有密钥材料中安全生成一个或多个密钥的密码学函数.

基本概念:
- 输入: 原始密钥/密码、盐(Salt)、上下文信息(info)
- 输出: 指定长度、相互独立的密钥

```
K = KDF(密钥, 盐, 上下文信息)
```

主要作用:
- 扩展密钥长度(短密钥 -> 长密钥)
- 派生多个子密钥(加密/MAC/会话密钥)
- 防止弱密钥问题
- 隔离不同用途的密钥

常见 KDF 算法:
- HKDF(最常用): 基于HMAC; 常用于TLS、QUIC、IPsec
- PBKDF2: 面向口令; 通过多次迭代抵抗暴力破解
- scrypt/Argon2: 内存硬型(Memory-hard); 适合密码存储
- KDF in Counter / Feedback Mode: 常见于标准(NIST)

典型应用:
- TLS 会话密钥派生
- 从用户密码生成加密密钥
- VPN/安全通信
- 密钥层级管理(Key hierarchy)